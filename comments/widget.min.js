module.exports=await(async()=>{"use strict";const e=(()=>{const e=(async()=>{const{APIref:e,API:t,defaultStyles:n,currentUser:a,normalizeDate:r,http:i,wait:s,ExtString:l}=await(async()=>{const[{_system:{normalizeDate:e,wait:t,http:n,ExtString:a},defaultStyles:r},{APIref:i,API:s,currentUser:l}]=await(async()=>{const e=require(__dirname+"/../_system.min.js");return await Promise.all([(async()=>{const t=await e;return{_system:t,defaultStyles:await t.http.get(__dirname+"/style.css")}})(),(async()=>{const t=await require(__dirname+"/../APIref.min.js"),n=new t,a=(await e).Cookies.get("allbooms_token");var r={APIref:t,API:n,currentUser:a?await n.user.getInfo({token:a,list:["id","fullName","avatar"]}):{}};return r.currentUser.id?r.currentUser._token=a:r.currentUser=null,r})()])})();return{APIref:i,API:s,defaultStyles:r,currentUser:l,normalizeDate:e,wait:t,http:n,ExtString:a}})();return{APIref:e,API:t,defaultStyles:n,dictionary:{ru:{placeholder:"Ваш комментарий",submitText:"Отправить",submittingText:"Отправка...",userNotLogged:"Для добавления комментария",login:"Войдите"}},http:i,wait:s,currentUser:a,normalizeDate:r,String:l}})();return()=>e})();return await(async()=>{const{APIref:t,API:n,dictionary:a,wait:r,normalizeDate:i,currentUser:s,String:l}=await e();(async()=>{const{defaultStyles:t}=await e(),n=document.createElement("style");n.innerHTML=t,n.setAttribute("name","allbooms-comments-default"),document.head.appendChild(n)})();class c{constructor({id:e,text:n,user:{id:a,fullName:r,avatar:s},timestamp:l}){const c=document.createElement("table"),o=document.createElement("tbody"),d=document.createElement("tr"),m=document.createElement("tr"),u=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),b=document.createElement("td"),w=document.createElement("a"),f=document.createElement("a"),g=document.createElement("img");return u.setAttribute("rowspan","2"),b.setAttribute("colspan","2"),c.appendChild(o),o.appendChild(d),o.appendChild(m),d.appendChild(u),d.appendChild(p),d.appendChild(h),m.appendChild(b),u.appendChild(w),w.appendChild(g),p.appendChild(f),g.setAttribute("src",s),w.setAttribute("href",`https://${t.baseHost}/${a}`),f.setAttribute("href",`https://${t.baseHost}/${a}`),f.innerText=r,h.innerText=i(new Date(1e3*l)),b.innerText=n,c.setAttribute("class","allbooms-single-comment"),c}}const o=(()=>{return class extends Array{constructor(){super(),this.ids=[]}prependNew(e={comments:[]},t){e.comments.reverse().forEach(n=>{n.user=e.users[n.userid],(n=function(e){if(-1==this.ids.indexOf(e.id))return this.push(e),this.ids.push(e.id),e}.apply(this,[n]))&&d(n,t)})}}})();function d(e,t){e=new c(e),t.firstElementChild?t.insertBefore(e,t.firstElementChild):t.appendChild(e)}return class{constructor(e,t,i){i=Object.assign({lang:"ru"},i);const l=Object.assign(a[i.lang],i.strings),c=new o;this.conainer=document.createElement("div"),this.conainer.id=`comments-widget-${t}`,this.conainer.setAttribute("class","allbooms-comments-widget");var m=document.createElement("input"),u=document.createElement("button"),p=document.createElement("div"),h=document.createElement("style");return this.conainer.appendChild(m),this.conainer.appendChild(u),this.conainer.appendChild(p),this.conainer.appendChild(h),m.placeholder=l.placeholder,m.setAttribute("class","comment-input"),u.type="submit",u.setAttribute("class","comment-input-submit"),u.innerText=l.submitText,p.setAttribute("class","allbooms-comments-container"),h.setAttribute("scoped",""),h.innerHTML=i.style||"",s||(m.placeholder=l.userNotLogged,m.setAttribute("disabled",""),u.innerText=l.login,u.innerHTML=u.innerHTML+' <i class="allbooms-brand-icon-allbooms"></i>',u.classList.add("login-highlight")),u.addEventListener("click",async e=>{if(e.preventDefault(),s){if(a.value){u.setAttribute("disabled",""),u.value=l.submittingText;let{id:e,timestamp:r}=await n.comments.external.add({token:s._token,widget_id:t,text:a.value});var a=c.add({id:e,timestamp:r,user:s,text:a.value});a&&d(a,p),u.value=l.submitText,u.removeAttribute("disabled")}}else window.location.href="https://allbooms.com/getToken?callback=https%3A%2F%2Fapi.allbooms.com%2Fdev%2Fblank.html&appid=lSgmGGAVrVta3X9xeO3D1"}),async function e(t,a,i,s,l=2e3){t.prependNew(await n.comments.external.list({app_id:i,widget_id:s}),a),await r(l),e(t,a,i,s,l)}(c,p,e,t),this.conainer}}})()})();