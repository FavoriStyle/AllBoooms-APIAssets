"use strict";const console=(t=>{var e=!1;return window.console.groupCollapsed("AllBooms comments widget"),new Proxy(window.console,{get:(t,n)=>e&&"function"==typeof t[n]?(...e)=>{t.groupCollapsed("AllBooms comments widget"),t[n](...e),t.groupEnd()}:(e||"groupEnd"!=n||(e=!0),t[n])})})();document.head.appendChild((()=>{var t=["https://fonts.googleapis.com/css?family=Roboto","https://cdn.jsdelivr.net/gh/FavoriStyle/AllBooms-brand-icons@3.0.0/dist/allbooms-brand-icons.css"];t.forEach((e,n)=>{t[n]=`@import url("${e.replace('"',"%22").replace("\\","%5C")}");\n`});var e=document.createElement("style");return e.innerHTML=t.join(""),console.log("Added global style to use fonts in widget:\n",e.firstChild),e})());const getDefinitions=(()=>{const t=(async()=>{const{APIref:t,API:e,defaultStyles:n,currentUser:s,normalizeDate:a,http:i,wait:r,ExtString:o,Link:l,Cookies:d}=await(async()=>{const[{_system:{normalizeDate:t,wait:e,http:n,ExtString:s,Link:a,Cookies:i},defaultStyles:r},{APIref:o,API:l,currentUser:d}]=await(async()=>{const t=require(__dirname+"/../_system.min.js");return await Promise.all([(async()=>{const e=await t;return{_system:e,defaultStyles:await e.http.get(__dirname+"/style.css")}})(),(async()=>{const e=await require(__dirname+"/../APIref.min.js"),n=new e,s=(await t).Cookies.get("allbooms_token");var a={APIref:e,API:n,currentUser:s?await n.user.getInfo({token:s,list:["id","fullName","avatar"]}):{}};return a.currentUser.id?a.currentUser._token=s:a.currentUser=null,a})()])})();return{APIref:o,API:l,defaultStyles:r,currentUser:d,normalizeDate:t,wait:e,http:n,ExtString:s,Link:a,Cookies:i}})();return{APIref:t,API:e,defaultStyles:n,dictionary:{ru:{placeholder:"Ваш комментарий",submitText:"Отправить",submittingText:"Отправка...",userNotLogged:"Для добавления комментария",login:"Войдите"}},http:i,wait:r,currentUser:s,normalizeDate:a,String:o,Link:l,Cookies:d}})();return()=>t})(),res=(async()=>{const{APIref:t,API:e,dictionary:n,wait:s,normalizeDate:a,Link:i,Cookies:r,defaultStyles:o}=await getDefinitions();var{currentUser:l}=await getDefinitions();await(async()=>{var t=new i(location.href);void 0!==t.params.save_allbooms_token&&t.params.token&&((l=await e.user.getInfo({token:t.params.token,list:["id","fullName","avatar"]}))&&r.set("allbooms_token",t.params.token),delete t.params.save_allbooms_token,delete t.params.token,window.history.pushState(null,null,t.href))})();class d{constructor({id:e,text:n,user:{id:s,fullName:i,avatar:r},timestamp:o}){const l=document.createElement("table"),d=document.createElement("tbody"),c=document.createElement("tr"),u=document.createElement("tr"),m=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),g=document.createElement("td"),b=document.createElement("a"),f=document.createElement("a"),w=document.createElement("img");return m.setAttribute("rowspan","2"),g.setAttribute("colspan","2"),l.appendChild(d),d.appendChild(c),d.appendChild(u),c.appendChild(m),c.appendChild(p),c.appendChild(h),u.appendChild(g),m.appendChild(b),b.appendChild(w),p.appendChild(f),w.setAttribute("src",r),b.setAttribute("href",`https://${t.baseHost}/${s}`),f.setAttribute("href",`https://${t.baseHost}/${s}`),f.innerText=i,h.innerText=a(new Date(1e3*o)),g.innerText=n,l.setAttribute("class","single-comment"),l}}const c=(()=>{return class extends Array{constructor(){super(),this.ids=[]}prependNew(t={comments:[]},e){t.comments.reverse().forEach(n=>{n.user=t.users[n.userid],(n=function(t){if(-1==this.ids.indexOf(t.id))return this.push(t),this.ids.push(t.id),t}.apply(this,[n]))&&u(n,e)})}}})();function u(t,e){t=new d(t),e.firstElementChild?e.insertBefore(t,e.firstElementChild):e.appendChild(t)}class m{constructor(t,a,r){if(!/^[a-zA-Z0-9_\-]+$/.test(a))throw new SyntaxError("widgetID must contain only latin symbols, digits, - or _");r=Object.assign({lang:"ru"},r||{});const d=Object.assign(n[r.lang],r.strings||{}),m=new c;this.conainer=document.createElement("div"),this.conainer.id=`comments-widget-${a}`,this.conainer.setAttribute("class","allbooms-comments-widget"),this.conainer.setAttribute("style","width: 280px; --theme-color: #00b1b3; --highlighted-text-color: #ffffff");var p=document.createElement("input"),h=document.createElement("button"),g=document.createElement("div"),b=document.createElement("style");return this.conainer.appendChild(p),this.conainer.appendChild(h),this.conainer.appendChild(g),document.head.appendChild(b),p.placeholder=d.placeholder,p.setAttribute("class","comment-input"),h.type="submit",h.setAttribute("class","comment-input-submit"),h.innerText=d.submitText,g.setAttribute("class","comments-container"),b.innerHTML=o+(r.style||""),(()=>{var t,e="";for(t=0;t<b.sheet.cssRules.length;t++)e+=`#${this.conainer.id} ${b.sheet.cssRules[t].cssText}`;b.innerHTML=e,console.log([b.sheet])})(),l||(p.placeholder=d.userNotLogged,p.setAttribute("disabled",""),h.innerText=d.login,h.innerHTML=h.innerHTML+' <i class="allbooms-brand-icons-allbooms"></i>',h.classList.add("login-highlight")),h.addEventListener("click",async n=>{if(n.preventDefault(),l){if(s.value){h.setAttribute("disabled",""),h.value=d.submittingText;let{id:t,timestamp:n}=await e.comments.external.add({token:l._token,widget_id:a,text:s.value});var s=m.add({id:t,timestamp:n,user:l,text:s.value});s&&u(s,g),h.value=d.submitText,h.removeAttribute("disabled")}}else{var r=new i(location.href);r.params.save_allbooms_token="",window.location.href=`https://allbooms.com/getToken?callback=${encodeURIComponent(r.href)}&appid=${encodeURIComponent(t)}`}}),async function t(n,a,i,r,o=2e3){n.prependNew(await e.comments.external.list({app_id:i,widget_id:r}),a),await s(o),t(n,a,i,r,o)}(m,g,t,a),this.conainer}}return customElements.define("allbooms-comments",class extends HTMLElement{constructor(){super();var t=this.attachShadow({mode:"closed"});const e=this.getAttribute("data-appID"),n=this.getAttribute("data-widgetID"),s={lang:this.getAttribute("data-lang"),strings:this.getAttribute("data-strings"),style:this.getAttribute("data-style")};s.strings&&(s.strings=JSON.parse(s.strings)),t.appendChild(new m(e,n,s))}}),class{constructor(t,e,n){const s=document.createElement("allbooms-comments");return s.setAttribute("data-appID",t),s.setAttribute("data-widgetID",e),n&&(n.lang&&s.setAttribute("data-lang",n.lang),n.strings&&s.setAttribute("data-strings",JSON.stringify(n.strings)),n.style&&s.setAttribute("data-style",n.style)),s}}})();exports.__esModule=!0,exports.default=res;;try{let b=await exports.default;module.exports=b}catch(b){console.warn('Looks like "await" cannot be used at the top level of the module. Defaulted export to ES module')}console.log('Exported',module.exports);console.groupEnd();