"use strict";const getDefinitions=(()=>{const e=(async()=>{const{APIref:e,API:t,defaultStyles:n,currentUser:a,normalizeDate:s,http:i,wait:r,ExtString:o,Link:l,Cookies:d}=await(async()=>{const[{_system:{normalizeDate:e,wait:t,http:n,ExtString:a,Link:s,Cookies:i},defaultStyles:r},{APIref:o,API:l,currentUser:d}]=await(async()=>{const e=require(__dirname+"/../_system.min.js");return await Promise.all([(async()=>{const t=await e;return{_system:t,defaultStyles:await t.http.get(__dirname+"/style.css")}})(),(async()=>{const t=await require(__dirname+"/../APIref.min.js"),n=new t,a=(await e).Cookies.get("allbooms_token");var s={APIref:t,API:n,currentUser:a?await n.user.getInfo({token:a,list:["id","fullName","avatar"]}):{}};return s.currentUser.id?s.currentUser._token=a:s.currentUser=null,s})()])})();return{APIref:o,API:l,defaultStyles:r,currentUser:d,normalizeDate:e,wait:t,http:n,ExtString:a,Link:s,Cookies:i}})();return{APIref:e,API:t,defaultStyles:n,dictionary:{ru:{placeholder:"Ваш комментарий",submitText:"Отправить",submittingText:"Отправка...",userNotLogged:"Для добавления комментария",login:"Войдите"}},http:i,wait:r,currentUser:a,normalizeDate:s,String:o,Link:l,Cookies:d}})();return()=>e})(),res=(async()=>{const{APIref:e,API:t,dictionary:n,wait:a,normalizeDate:s,Link:i,Cookies:r}=await getDefinitions();var{currentUser:o}=await getDefinitions();(async()=>{const{defaultStyles:e}=await getDefinitions(),t=document.createElement("style");t.innerHTML=e,t.setAttribute("name","allbooms-comments-default"),document.head.appendChild(t)})(),await(async()=>{var e=new i(location.href);void 0!==e.params.save_allbooms_token&&e.params.token&&((o=await t.user.getInfo({token:e.params.token,list:["id","fullName","avatar"]}))&&r.set("allbooms_token",e.params.token),delete e.params.save_allbooms_token,delete e.params.token,window.history.pushState(null,null,e.href))})();class l{constructor({id:t,text:n,user:{id:a,fullName:i,avatar:r},timestamp:o}){const l=document.createElement("table"),d=document.createElement("tbody"),c=document.createElement("tr"),m=document.createElement("tr"),u=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),b=document.createElement("td"),f=document.createElement("a"),w=document.createElement("a"),g=document.createElement("img");return u.setAttribute("rowspan","2"),b.setAttribute("colspan","2"),l.appendChild(d),d.appendChild(c),d.appendChild(m),c.appendChild(u),c.appendChild(p),c.appendChild(h),m.appendChild(b),u.appendChild(f),f.appendChild(g),p.appendChild(w),g.setAttribute("src",r),f.setAttribute("href",`https://${e.baseHost}/${a}`),w.setAttribute("href",`https://${e.baseHost}/${a}`),w.innerText=i,h.innerText=s(new Date(1e3*o)),b.innerText=n,l.setAttribute("class","allbooms-single-comment"),l}}const d=(()=>{return class extends Array{constructor(){super(),this.ids=[]}prependNew(e={comments:[]},t){e.comments.reverse().forEach(n=>{n.user=e.users[n.userid],(n=function(e){if(-1==this.ids.indexOf(e.id))return this.push(e),this.ids.push(e.id),e}.apply(this,[n]))&&c(n,t)})}}})();function c(e,t){e=new l(e),t.firstElementChild?t.insertBefore(e,t.firstElementChild):t.appendChild(e)}return class{constructor(e,s,r){r=Object.assign({lang:"ru"},r);const l=Object.assign(n[r.lang],r.strings),m=new d;this.conainer=document.createElement("div"),this.conainer.id=`comments-widget-${s}`,this.conainer.setAttribute("class","allbooms-comments-widget");var u=document.createElement("input"),p=document.createElement("button"),h=document.createElement("div"),b=document.createElement("style"),f=this.conainer.attachShadow({mode:"open"});return f.appendChild(u),f.appendChild(p),f.appendChild(h),f.appendChild(b),u.placeholder=l.placeholder,u.setAttribute("class","comment-input"),p.type="submit",p.setAttribute("class","comment-input-submit"),p.innerText=l.submitText,h.setAttribute("class","allbooms-comments-container"),b.innerHTML=r.style||"",o||(u.placeholder=l.userNotLogged,u.setAttribute("disabled",""),p.innerText=l.login,p.innerHTML=p.innerHTML+' <i class="allbooms-brand-icons-allbooms"></i>',p.classList.add("login-highlight")),p.addEventListener("click",async n=>{if(n.preventDefault(),o){if(a.value){p.setAttribute("disabled",""),p.value=l.submittingText;let{id:e,timestamp:n}=await t.comments.external.add({token:o._token,widget_id:s,text:a.value});var a=m.add({id:e,timestamp:n,user:o,text:a.value});a&&c(a,h),p.value=l.submitText,p.removeAttribute("disabled")}}else{var r=new i(location.href);r.params.save_allbooms_token="",window.location.href=`https://allbooms.com/getToken?callback=${encodeURIComponent(r.href)}&appid=${encodeURIComponent(e)}`}}),async function e(n,s,i,r,o=2e3){n.prependNew(await t.comments.external.list({app_id:i,widget_id:r}),s),await a(o),e(n,s,i,r,o)}(m,h,e,s),this.conainer}}})();exports.__esModule=!0,exports.default=res;var logs=[];try{let b=await exports.default;module.exports=b}catch(b){logs.push({type:'log',data:['%cLooks like "await" cannot be used at the top level of the module. Defaulted export to ES module','background: #332B00; color: #DFC185']})}logs.push({type:'log',data:['Exported',module.exports]}),(()=>{return function b({name:c,childs:d}){try{console.group(c),d.forEach(({type:f,data:g,name:h,childs:i})=>{'log'==f?console.log(...g):'group'==f&&b({name:h,childs:i})}),console.groupEnd()}catch(f){console.warn('Your browser does not support group logging, so it will not be shown to you')}}})()({name:'AllBooms comments widget',childs:logs})