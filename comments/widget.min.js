module.exports=await(async()=>{"use strict";const e=(()=>{const e=(async()=>{const{APIref:e,API:t,defaultStyles:n,currentUser:a,normalizeDate:s,http:i,wait:r}=await(async()=>{const[{_system:{normalizeDate:e,wait:t,http:n},defaultStyles:a},{APIref:s,API:i,currentUser:r}]=await Promise.all([(async()=>{const e=await require(__dirname+"/../_system.min.js");return{_system:e,defaultStyles:await e.http.get(__dirname+"/style.css")}})(),(async()=>{const e=await require(__dirname+"/../APIref.min.js");return{APIref:e,API:new e,currentUser:{id:"0TksO20JRaX4jP9sACjL0HosH0l1",fullName:"Влад <KaMeHb> Марченко",avatar:"https://firebasestorage.googleapis.com/v0/b/social-net-test.appspot.com/o/images%2F77576c58-a824-467c-a688-5f8d2140bbc8.jpg?alt=media&token=a8d732ff-1e90-4bc2-868c-32b42439b594",_token:"`3\\M`Yo'&9I+'sN&W%G\"ldxGAtE+LJMyc.8ngRY!j=i!'|Q35^'\"wW*5g)D\"WfC@"}}})()]);return{APIref:s,API:i,defaultStyles:a,currentUser:r,normalizeDate:e,wait:t,http:n}})();return{APIref:e,API:t,defaultStyles:n,dictionary:{ru:{placeholder:"Ваш комментарий",submitText:"Отправить",submittingText:"Отправка..."}},http:i,wait:r,currentUser:a,normalizeDate:s}})();return()=>e})();return await(async()=>{const{APIref:t,API:n,dictionary:a,wait:s,normalizeDate:i,currentUser:r}=await e();(async()=>{const{defaultStyles:t}=await e(),n=document.createElement("style");n.innerHTML=t,n.setAttribute("name","allbooms-comments-default"),document.head.appendChild(n)})();class c{constructor({id:e,text:n,user:{id:a,fullName:s,avatar:r},timestamp:c}){const d=document.createElement("table"),l=document.createElement("tbody"),o=document.createElement("tr"),m=document.createElement("tr"),u=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),b=document.createElement("td"),f=document.createElement("a"),A=document.createElement("a"),w=document.createElement("img");return u.setAttribute("rowspan","2"),b.setAttribute("colspan","2"),d.appendChild(l),l.appendChild(o),l.appendChild(m),o.appendChild(u),o.appendChild(p),o.appendChild(h),m.appendChild(b),u.appendChild(f),f.appendChild(w),p.appendChild(A),w.setAttribute("src",r),f.setAttribute("href",`https://${t.baseHost}/${a}`),A.setAttribute("href",`https://${t.baseHost}/${a}`),A.innerText=s,h.innerText=i(new Date(1e3*c)),b.innerText=n,d.setAttribute("class","allbooms-single-comment"),d}}const d=(()=>{return class extends Array{constructor(){super(),this.ids=[]}prependNew(e={comments:[]},t){e.comments.reverse().forEach(n=>{n.user=e.users[n.userid],(n=function(e){if(-1==this.ids.indexOf(e.id))return this.push(e),this.ids.push(e.id),e}.apply(this,[n]))&&l(n,t)})}}})();function l(e,t){e=new c(e),t.firstElementChild?t.insertBefore(e,t.firstElementChild):t.appendChild(e)}return class{constructor(e,t,i){i=Object.assign({lang:"ru"},i);const c=Object.assign(a[i.lang],i.strings),o=new d;this.conainer=document.createElement("div"),this.conainer.id=`comments-widget-${t}`,this.conainer.setAttribute("class","allbooms-comments-widget");var m=document.createElement("input"),u=document.createElement("input"),p=document.createElement("div"),h=document.createElement("style");return this.conainer.appendChild(m),this.conainer.appendChild(u),this.conainer.appendChild(p),this.conainer.appendChild(h),m.placeholder=c.placeholder,m.setAttribute("class","comment-input"),u.type="submit",u.setAttribute("class","comment-input-submit"),u.value=c.submitText,p.setAttribute("class","allbooms-comments-container"),h.setAttribute("scoped",""),h.innerHTML=i.style||"",u.addEventListener("click",async e=>{if(e.preventDefault(),a.value){u.setAttribute("disabled",""),u.value=c.submittingText;let{id:e,timestamp:s}=await n.comments.external.add({token:r._token,widget_id:t,text:a.value});var a=o.add({id:e,timestamp:s,user:r,text:a.value});a&&l(a,p),u.value=c.submitText,u.removeAttribute("disabled")}}),async function e(t,a,i,r,c=2e3){t.prependNew(await n.comments.external.list({app_id:i,widget_id:r}),a),await s(c),e(t,a,i,r,c)}(o,p,e,t),this.conainer}}})()})();