"use strict";const console=(e=>{var t=!1;return window.console.groupCollapsed("AllBooms comments widget"),new Proxy(window.console,{get:(e,n)=>t&&"function"==typeof e[n]?(...t)=>{e.groupCollapsed("AllBooms comments widget"),e[n](...t),e.groupEnd()}:(t||"groupEnd"!=n||(t=!0),e[n])})})();document.head.appendChild((()=>{var e=["https://fonts.googleapis.com/css?family=Roboto","https://cdn.jsdelivr.net/gh/FavoriStyle/AllBooms-brand-icons@3.0.0/dist/allbooms-brand-icons.css"];e.forEach((t,n)=>{e[n]=`@import url("${t.replace('"',"%22").replace("\\","%5C")}");\n`});var t=document.createElement("style");return t.innerHTML=e.join(""),console.log("Added global style to use fonts in widget:\n",t.firstChild),t})());const getDefinitions=(()=>{const e=(async()=>{const{APIref:e,API:t,defaultStyles:n,currentUser:s,normalizeDate:i,http:a,wait:r,ExtString:o,Link:l,Cookies:c}=await(async()=>{const[{_system:{normalizeDate:e,wait:t,http:n,ExtString:s,Link:i,Cookies:a},defaultStyles:r},{APIref:o,API:l,currentUser:c}]=await(async()=>{const e=require(__dirname+"/../_system.min.js");return await Promise.all([(async()=>{const t=await e;return{_system:t,defaultStyles:await t.http.get(__dirname+"/style.css")}})(),(async()=>{const t=await require(__dirname+"/../APIref.min.js"),n=new t,s=(await e).Cookies.get("allbooms_token");var i={APIref:t,API:n,currentUser:s?await n.user.getInfo({token:s,list:["id","fullName","avatar"]}):{}};return i.currentUser.id?i.currentUser._token=s:i.currentUser=null,i})()])})();return{APIref:o,API:l,defaultStyles:r,currentUser:c,normalizeDate:e,wait:t,http:n,ExtString:s,Link:i,Cookies:a}})();return{APIref:e,API:t,defaultStyles:n,dictionary:{ru:{placeholder:"Ваш комментарий",submitText:"Отправить",submittingText:"Отправка...",userNotLogged:"Для добавления комментария",login:"Войдите"}},http:a,wait:r,currentUser:s,normalizeDate:i,String:o,Link:l,Cookies:c}})();return()=>e})(),res=(async()=>{const{APIref:e,API:t,dictionary:n,wait:s,normalizeDate:i,Link:a,Cookies:r,defaultStyles:o}=await getDefinitions();var{currentUser:l}=await getDefinitions();await(async()=>{var e=new a(location.href);void 0!==e.params.save_allbooms_token&&e.params.token&&((l=await t.user.getInfo({token:e.params.token,list:["id","fullName","avatar"]}))&&r.set("allbooms_token",e.params.token),delete e.params.save_allbooms_token,delete e.params.token,window.history.pushState(null,null,e.href))})();class c{constructor({id:t,text:n,user:{id:s,fullName:a,avatar:r},timestamp:o}){const l=document.createElement("table"),c=document.createElement("tbody"),d=document.createElement("tr"),m=document.createElement("tr"),u=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),f=document.createElement("td"),g=document.createElement("a"),b=document.createElement("a"),w=document.createElement("img");return u.setAttribute("rowspan","2"),f.setAttribute("colspan","2"),l.appendChild(c),c.appendChild(d),c.appendChild(m),d.appendChild(u),d.appendChild(p),d.appendChild(h),m.appendChild(f),u.appendChild(g),g.appendChild(w),p.appendChild(b),w.setAttribute("src",r),g.setAttribute("href",`https://${e.baseHost}/${s}`),b.setAttribute("href",`https://${e.baseHost}/${s}`),b.innerText=a,h.innerText=i(new Date(1e3*o)),f.innerText=n,l.setAttribute("class","single-comment"),l}}const d=(()=>{return class extends Array{constructor(){super(),this.ids=[]}prependNew(e={comments:[]},t){e.comments.reverse().forEach(n=>{n.user=e.users[n.userid],(n=function(e){if(-1==this.ids.indexOf(e.id))return this.push(e),this.ids.push(e.id),e}.apply(this,[n]))&&m(n,t)})}}})();function m(e,t){e=new c(e),t.firstElementChild?t.insertBefore(e,t.firstElementChild):t.appendChild(e)}return class{constructor(e,i,r){if(!/^[a-zA-Z0-9_\-]+$/.test(i))throw new SyntaxError("widgetID must contain only latin symbols, digits, - or _");r=Object.assign({lang:"ru"},r);const c=Object.assign(n[r.lang],r.strings),u=new d;this.conainer=document.createElement("div"),this.conainer.id=`comments-widget-${i}`,this.conainer.setAttribute("class","allbooms-comments-widget"),this.conainer.setAttribute("style","width: 280px; --theme-color: #00b1b3; --highlighted-text-color: #ffffff");var p=document.createElement("input"),h=document.createElement("button"),f=document.createElement("div"),g=document.createElement("style");return this.conainer.appendChild(p),this.conainer.appendChild(h),this.conainer.appendChild(f),document.head.appendChild(g),p.placeholder=c.placeholder,p.setAttribute("class","comment-input"),h.type="submit",h.setAttribute("class","comment-input-submit"),h.innerText=c.submitText,f.setAttribute("class","comments-container"),g.innerHTML=o+(r.style||""),(()=>{var e,t="";for(e=0;e<g.sheet.cssRules.length;e++)t+=`#${this.conainer.id} ${g.sheet.cssRules[e].cssText}`;g.innerHTML=t,console.log([g.sheet])})(),l||(p.placeholder=c.userNotLogged,p.setAttribute("disabled",""),h.innerText=c.login,h.innerHTML=h.innerHTML+' <i class="allbooms-brand-icons-allbooms"></i>',h.classList.add("login-highlight")),h.addEventListener("click",async n=>{if(n.preventDefault(),l){if(s.value){h.setAttribute("disabled",""),h.value=c.submittingText;let{id:e,timestamp:n}=await t.comments.external.add({token:l._token,widget_id:i,text:s.value});var s=u.add({id:e,timestamp:n,user:l,text:s.value});s&&m(s,f),h.value=c.submitText,h.removeAttribute("disabled")}}else{var r=new a(location.href);r.params.save_allbooms_token="",window.location.href=`https://allbooms.com/getToken?callback=${encodeURIComponent(r.href)}&appid=${encodeURIComponent(e)}`}}),async function e(n,i,a,r,o=2e3){n.prependNew(await t.comments.external.list({app_id:a,widget_id:r}),i),await s(o),e(n,i,a,r,o)}(u,f,e,i),this.conainer}}})();exports.__esModule=!0,exports.default=res;;try{let b=await exports.default;module.exports=b}catch(b){console.warn('Looks like "await" cannot be used at the top level of the module. Defaulted export to ES module')}console.log('Exported',module.exports);console.groupEnd();