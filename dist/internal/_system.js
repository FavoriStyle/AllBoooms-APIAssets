import APIReference from"./APIref.js";const LinkInternalElement=Symbol("LinkInternalElement"),LinkInternalParams=Symbol("LinkInternalParams"),API=new APIReference;export const normalizeDate=(()=>{const e=6e4,t=60*e,n=24*t,r={yesterday:"вчера",before:"назад",jan:"янв",feb:"фев",mar:"мар",apr:"апр",may:"мая",jun:"июн",jul:"июл",aug:"авг",sep:"сен",oct:"окт",nov:"ноя",dec:"дек",hours:"час",mins:"мин",newly:"только что"};function o(e,t,n,r){return`${e/t|0} ${n} ${r.before}`}return(s,a={})=>{s=function(e){return new Date(e).getFullYear()<2e3?new Date(1e3*e):e}(s);const i=new Date,c=function(e){return e-e%n}(i),l=c-n,u=i-s;return a=Object.assign({},r,a),u<e?a.newly:u<n?function(n,r){return n%t===n?o(n,e,r.mins,r):o(n,t,r.hours,r)}(u,a):c>s&&l<s?a.yesterday:function(e,t,n){t=new Date(t);const r=[n.jan,n.feb,n.mar,n.apr,n.may,n.jun,n.jul,n.aug,n.sep,n.oct,n.nov,n.dec];var o=t.getFullYear();return o=e.getFullYear()===o?"":" "+o,t.getDate()+" "+r[t.getMonth()]+o}(i,s,a)}})();export function wait(e){return new Promise(t=>setTimeout(t,e))};export const http={get(e){var t=new XMLHttpRequest;return new Promise((n,r)=>{t.open("GET",e,!0),t.onreadystatechange=(()=>{4==t.readyState&&(200!=t.status?r(new Error(`Cannot get requested url. Error ${t.status}: ${t.statusText}`)):n(t.responseText))}),t.send()})},post(e,t,n="application/x-www-form-urlencoded"){var r=new XMLHttpRequest;return new Promise((o,s)=>{r.open("POST",e,!0),r.setRequestHeader("Content-Type",n),r.onreadystatechange=(()=>{4==r.readyState&&(200!=r.status?s(new Error(`Cannot post to requested url. Error ${r.status}: ${r.statusText}`)):o(r.responseText))}),r.send(t)})}};export const Cookies={get(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},set(e,t,n){var r=(n=n||{}).expires;if("number"==typeof r&&r){var o=new Date;o.setTime(o.getTime()+1e3*r),r=n.expires=o}r&&r.toUTCString&&(n.expires=r.toUTCString());var s=e+"="+(t=encodeURIComponent(t));for(var a in n){s+="; "+a;var i=n[a];!0!==i&&(s+="="+i)}document.cookie=s},del(e){Cookies.set(e,"",{expires:-1})}};export class Link{constructor(e){this[LinkInternalElement]=window.document.createElement("a"),this.href=e}get href(){return this[LinkInternalElement].href}set href(e){this[LinkInternalElement].href=e,this[LinkInternalParams]={},this[LinkInternalElement].search.slice(1).split("&").forEach(e=>{""!=e&&(e=e.split("="),this[LinkInternalParams][decodeURIComponent(e[0])]=decodeURIComponent(e[1]||""))})}get params(){var e=this;return new Proxy(this[LinkInternalParams],{set:(t,n,r)=>(t[n]=r,e.params=t,!0),deleteProperty:(t,n)=>(delete t[n],e.params=t,!0)})}set params(e){var t="";for(var n in e)t+="&"+encodeURIComponent(n)+(e[n]?"="+encodeURIComponent(e[n]):"");this[LinkInternalElement].search="?"+t.slice(1)}};export class ExtString extends String{reverse(){for(var e="",t=this.length-1;t>=0;t--)e+=this[t];return new ExtString(e)}};export function currentFile(){const e=new Error("").stack.split("\n"),t=(e[e.length-1]||e[e.length-2]).split(/:\d+:\d+/)[0];var n=t.split(":")[0].split(/\W/);n=n[n.length-1]+":";const r=t.split(n);return r.shift(),n+r.join(n)};export function currentDir(){const e=currentFile();if(/^data:/.test(e))throw new Error("data URIs is not supported");const t=e.split("/");return t.pop(),t.join("/")};const _createElementChildContext=Object(Symbol());export function createElement({name:e,attrs:t,html:n,childs:r}){t=t||{},n=n||"",r=r||[];var o="";for(var s in t)o+=` ${s}="${t[s]}"`;const a=`<${e}${o}>${n+=r.map(createElement.bind(_createElementChildContext)).join("")}</${e}>`;if(this===_createElementChildContext)return a;const i=document.createElement("div");return i.innerHTML=a,i.removeChild(i.children[0]||i.childNodes[0])};Object.assign(createElement,{src:createElement.bind(_createElementChildContext)});export function htmlSafeText(e){return e.replace("<","&lt;").replace(">","&gt;")};export function currentUser(){return new Promise(e=>{const t=currentToken();t?API.user.getMe({token:t}).then(e).catch(()=>e(null)):e(null)})};export const currentToken=()=>Cookies.get("allbooms_token");currentToken.save=(e=>Cookies.set("allbooms_token",e,{Path:"/"}));export function argsEncode(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};export function argsDecode(e){var t={};return e.split("&").forEach(e=>{var n=e.split("=");t[decodeURIComponent(n.shift())]=decodeURIComponent(n.join("="))}),t};export const rand=()=>Math.random().toString(36).substring(2,15);export const setImmediate=(()=>{var e={},t=e,n=Math.random();return window.addEventListener("message",t=>{if(t.data==n){var r=(e=e.next).func;delete e.func,r()}}),e=>{t=t.next={func:e},window.postMessage(n,"*")}})();export function waitForProp(e,t,...n){const r=Object.prototype.hasOwnProperty.bind(e,t);return new Promise(o=>{setImmediate(function s(){r()&&-1===n.indexOf(e[t])?o():setImmediate(s)})})};